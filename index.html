<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Inventario - Don Yeyo</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Login Styles */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .login-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            width: 100%;
            max-width: 420px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            overflow: hidden;
            border: 3px solid #667eea;
        }

        .logo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .company-name {
            font-size: 28px;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 8px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .subtitle {
            color: #4a5568;
            font-size: 16px;
            font-weight: 500;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2d3748;
            font-size: 14px;
        }

        .form-control {
            width: 100%;
            padding: 15px 18px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.9);
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-1px);
        }

        .password-container {
            position: relative;
        }

        .password-toggle {
            position: absolute;
            right: 18px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #4a5568;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: color 0.3s;
        }

        .password-toggle:hover {
            color: #667eea;
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .test-users {
            margin-top: 25px;
            padding: 20px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 12px;
            font-size: 13px;
            color: #4a5568;
            border-left: 4px solid #667eea;
        }

        /* Main App Styles */
        .main-app {
            display: none;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 25px 0;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            margin-bottom: 25px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .header-left {
            display: flex;
            align-items: center;
        }

        .header-logo {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 20px;
            overflow: hidden;
            border: 3px solid #667eea;
        }

        .header-logo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .header-text h1 {
            font-size: 28px;
            color: #2d3748;
            margin-bottom: 5px;
            font-weight: 700;
        }

        .header-text p {
            color: #4a5568;
            font-size: 16px;
            font-weight: 500;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 25px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            color: #4a5568;
            font-weight: 500;
            background: rgba(102, 126, 234, 0.1);
            padding: 10px 15px;
            border-radius: 25px;
        }

        .logout-btn {
            background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            border-radius: 25px;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(229, 62, 62, 0.3);
        }

        /* Navigation */
        .nav-tabs {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .nav-tabs ul {
            list-style: none;
            display: flex;
            padding: 8px;
        }

        .nav-tabs li {
            margin-right: 5px;
        }

        .nav-tabs button {
            background: none;
            border: none;
            padding: 15px 25px;
            font-size: 16px;
            font-weight: 600;
            color: #4a5568;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .nav-tabs button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        /* Status Legend */
        .status-legend {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .status-legend h3 {
            margin-bottom: 20px;
            color: #2d3748;
            font-size: 20px;
            font-weight: 700;
        }

        .status-items {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 18px;
            background: rgba(255,255,255,0.7);
            border-radius: 10px;
            border: 1px solid rgba(0,0,0,0.05);
        }

        .status-color {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .status-green { background: linear-gradient(135deg, #48bb78 0%, #38a169 100%); }
        .status-yellow { background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%); }
        .status-orange { background: linear-gradient(135deg, #f6ad55 0%, #ed8936 100%); }
        .status-red { background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%); }
        .status-black { background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%); }

        /* Color Selector Styles */
        .color-selector {
            background: rgba(255,255,255,0.5);
            padding: 20px;
            border-radius: 12px;
            border: 2px solid rgba(0,0,0,0.05);
        }

        .color-options {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 15px;
        }

        .color-option {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            position: relative;
        }

        .color-option:hover {
            transform: scale(1.15);
            box-shadow: 0 6px 20px rgba(0,0,0,0.25);
        }

        .color-option.selected {
            border-color: #2d3748;
            transform: scale(1.2);
            box-shadow: 0 0 0 3px rgba(45, 55, 72, 0.3);
        }

        .color-option.selected::after {
            content: '‚úì';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            font-size: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }

        /* Controls */
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .controls-left {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .select-control {
            padding: 12px 18px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 12px;
            font-size: 16px;
            min-width: 220px;
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(10px);
            color: #2d3748;
            font-weight: 500;
        }

        .select-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
        }

        /* Table */
        .table-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th,
        .table td {
            padding: 18px;
            text-align: left;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        .table th {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            font-weight: 700;
            color: #2d3748;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .table tr:hover {
            background: rgba(102, 126, 234, 0.05);
        }

        .quantity-status {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .quantity-indicator {
            width: 30px;
            height: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            background: none;
            border: none;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
        }

        .action-btn.edit {
            color: #667eea;
        }

        .action-btn.edit:hover {
            background: rgba(102, 126, 234, 0.1);
            transform: scale(1.1);
        }

        .action-btn.delete {
            color: #e53e3e;
        }

        .action-btn.delete:hover {
            background: rgba(229, 62, 62, 0.1);
            transform: scale(1.1);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 35px;
            border-radius: 20px;
            width: 90%;
            max-width: 550px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            color: #2d3748;
        }

        .close-btn {
            background: rgba(229, 62, 62, 0.1);
            border: none;
            font-size: 20px;
            color: #e53e3e;
            cursor: pointer;
            padding: 8px;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(229, 62, 62, 0.2);
            transform: scale(1.1);
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
        }

        .btn-secondary {
            background: rgba(74, 85, 104, 0.1);
            color: #4a5568;
            border: 2px solid rgba(74, 85, 104, 0.2);
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: rgba(74, 85, 104, 0.2);
            transform: translateY(-1px);
        }

        .form-row {
            display: flex;
            gap: 20px;
        }

        .form-row .form-group {
            flex: 1;
        }

        textarea.form-control {
            resize: vertical;
            min-height: 100px;
            font-family: inherit;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header-content {
                flex-direction: column;
                text-align: center;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .controls-left {
                flex-direction: column;
            }

            .status-items {
                flex-direction: column;
                gap: 15px;
            }

            .table-container {
                overflow-x: auto;
            }

            .table {
                min-width: 800px;
            }

            .form-row {
                flex-direction: column;
            }

            .modal-content {
                width: 95%;
                padding: 25px;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <div class="login-card">
            <div class="login-header">
                <div class="logo">
                    <img src="https://i.postimg.cc/fLsf1kT0/Logo-PNG.png" alt="Logo Don Yeyo">
                </div>
                <div class="company-name">Don Yeyo</div>
                <div class="subtitle">Sistema de Gesti√≥n de Inventario</div>
            </div>
            
            <div class="form-group">
                <label for="username">Usuario</label>
                <input type="text" id="username" class="form-control" placeholder="Ingresa tu usuario">
            </div>
            
            <div class="form-group">
                <label for="password">Contrase√±a</label>
                <div class="password-container">
                    <input type="password" id="password" class="form-control" placeholder="Ingresa tu contrase√±a">
                    <button type="button" class="password-toggle" onclick="togglePassword()">
                        <i class="fas fa-eye" id="passwordIcon"></i>
                    </button>
                </div>
            </div>
            
            <button class="btn" onclick="login()">
                <i class="fas fa-sign-in-alt"></i>
                Iniciar Sesi√≥n
            </button>
            
            <div class="test-users">
                <strong>üí° Credenciales de acceso:</strong><br>
                <strong>Admin:</strong> Maria.Jaime<br>
                <strong>Yervin:</strong> 1303
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="main-app">
        <div class="header">
            <div class="container">
                <div class="header-content">
                    <div class="header-left">
                        <div class="header-logo">
                            <img src="https://i.postimg.cc/fLsf1kT0/Logo-PNG.png" alt="Logo Don Yeyo">
                        </div>
                        <div class="header-text">
                            <h1>Don Yeyo</h1>
                            <p>Sistema de Gesti√≥n de Inventario</p>
                        </div>
                    </div>
                    <div class="header-right">
                        <div class="user-info">
                            <i class="fas fa-user-circle"></i>
                            <span id="currentUser"></span>
                        </div>
                        <button class="logout-btn" onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i>
                            Cerrar Sesi√≥n
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="nav-tabs">
            <div class="container">
                <ul>
                    <li><button class="active" onclick="showTab('inventory')"><i class="fas fa-boxes"></i> Inventario</button></li>
                    <li><button onclick="showTab('audit')"><i class="fas fa-history"></i> Auditor√≠a</button></li>
                </ul>
            </div>
        </div>

        <div class="container">
            <!-- Inventory Tab -->
            <div id="inventoryTab">
                <div class="status-legend">
                    <h3><i class="fas fa-chart-bar"></i> Estado del Inventario</h3>
                    <div class="status-items">
                        <div class="status-item">
                            <div class="status-color status-green"></div>
                            <span><strong>Stock Completo
                        </div>
                        <div class="status-item">
                            <div class="status-color status-yellow"></div>
                            <span><strong>Stock Medio
                        </div>
                        <div class="status-item">
                            <div class="status-color status-orange"></div>
                            <span><strong>Stock Bajo
                        </div>
                        <div class="status-item">
                            <div class="status-color status-red"></div>
                            <span><strong>Sin Stock
                        </div>
                        <div class="status-item">
                            <div class="status-color status-black"></div>
                            <span><strong>Error</strong> (Datos inv√°lidos)</span>
                        </div>
                    </div>
                </div>

                <div class="controls">
                    <div class="controls-left">
                        <select id="categoryFilter" class="select-control" onchange="filterProducts()">
                            <option value="">üìã Todas las categor√≠as</option>
                        </select>
                    </div>
                    <button class="btn-primary" onclick="showProductModal()">
                        <i class="fas fa-plus-circle"></i>
                        Agregar Producto
                    </button>
                </div>

                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th><i class="fas fa-traffic-light"></i> Estado</th>
                                <th><i class="fas fa-box"></i> Producto</th>
                                <th><i class="fas fa-tags"></i> Categor√≠a</th>
                                <th><i class="fas fa-cubes"></i> Cantidad</th>
                                <th><i class="fas fa-calendar"></i> Fecha</th>
                                <th><i class="fas fa-arrow-up"></i> Entrada</th>
                                <th><i class="fas fa-sticky-note"></i> Observaciones</th>
                                <th><i class="fas fa-cog"></i> Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="productsTable">
                            <!-- Productos se cargar√°n aqu√≠ -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Audit Tab -->
            <div id="auditTab" style="display: none;">
                <div class="status-legend">
                    <h3><i class="fas fa-history"></i> Historial de Auditor√≠a</h3>
                    <p style="color: #4a5568; margin-top: 10px;">Registro completo de todas las actividades del sistema</p>
                </div>
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th><i class="fas fa-clock"></i> Fecha y Hora</th>
                                <th><i class="fas fa-user"></i> Usuario</th>
                                <th><i class="fas fa-tasks"></i> Acci√≥n</th>
                                <th><i class="fas fa-box"></i> Producto</th>
                                <th><i class="fas fa-info-circle"></i> Detalles</th>
                            </tr>
                        </thead>
                        <tbody id="auditTable">
                            <!-- Auditor√≠a se cargar√° aqu√≠ -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Product Modal -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle"><i class="fas fa-plus-circle"></i> Agregar Producto</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            
            <form id="productForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="productName"><i class="fas fa-box"></i> Nombre del Producto</label>
                        <input type="text" id="productName" class="form-control" placeholder="Ej: Coca Cola 2L" required>
                    </div>
                    <div class="form-group">
                        <label for="productCategory"><i class="fas fa-tags"></i> Categor√≠a</label>
                        <select id="productCategory" class="form-control" required>
                            <option value="">Seleccionar categor√≠a</option>
                            <option value="Bebidas">ü•§ Bebidas</option>
                            <option value="Comida">üçï Comida</option>
                            <option value="Limpieza">üßΩ Limpieza</option>
                            <option value="Cuidado Personal">üß¥ Cuidado Personal</option>
                            <option value="Papeler√≠a">üìù Papeler√≠a</option>
                            <option value="Otros">üì¶ Otros</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="productQuantity"><i class="fas fa-cubes"></i> Cantidad Actual</label>
                        <input type="number" id="productQuantity" class="form-control" min="0" placeholder="0" required>
                    </div>
                    <div class="form-group">
                        <label for="productEntry"><i class="fas fa-arrow-up"></i> Nueva Entrada</label>
                        <input type="number" id="productEntry" class="form-control" min="0" value="0" placeholder="0">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="productColor"><i class="fas fa-palette"></i> Color del Indicador</label>
                    <div class="color-selector">
                        <div class="color-options">
                            <div class="color-option" data-color="#48bb78" style="background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);" title="Verde - Stock Completo </div>
                            <div class="color-option" data-color="#ed8936" style="background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);" title="Naranja - Stock Medio </div>
                            <div class="color-option" data-color="#f6ad55" style="background: linear-gradient(135deg, #f6ad55 0%, #ed8936 100%);" title="Amarillo - Stock Bajo </div>
                            <div class="color-option" data-color="#e53e3e" style="background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);" title="Rojo - Sin Stock </div>
                            <div class="color-option" data-color="#2d3748" style="background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);" title="Negro - Error/Descontinuado"></div>
                        </div>
                        <input type="hidden" id="productColor" value="#48bb78">
                        <p style="font-size: 12px; color: #4a5568; margin-top: 15px; font-style: italic;">
                            üí° Selecciona el color que mejor represente el estado de tu producto
                        </p>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="productObservations"><i class="fas fa-sticky-note"></i> Observaciones</label>
                    <textarea id="productObservations" class="form-control" rows="3" placeholder="Notas adicionales sobre el producto..."></textarea>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" onclick="closeModal()">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-save"></i> Guardar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Variables globales
        let products = [];
        let auditLog = [];
        let currentUser = '';
        let editingProductId = null;
        let nextProductId = 1;

        // Datos de ejemplo con los 5 colores b√°sicos
        const sampleProducts = [
            { id: 1, name: 'Coca Cola 2L', category: 'Bebidas', quantity: 15, entry: 5, date: '2024-07-10', observations: 'Refrigerado, buen estado', color: '#48bb78' },
            { id: 2, name: 'Pan Integral Bimbo', category: 'Comida', quantity: 8, entry: 0, date: '2024-07-12', observations: 'Fresco, fecha de vencimiento OK', color: '#ed8936' },
            { id: 3, name: 'Detergente Ariel 1L', category: 'Limpieza', quantity: 3, entry: 2, date: '2024-07-08', observations: 'Stock bajo, reabastecer pronto', color: '#f6ad55' },
            { id: 4, name: 'Shampoo Head & Shoulders', category: 'Cuidado Personal', quantity: 0, entry: 0, date: '2024-07-05', observations: 'Agotado - Pendiente reposici√≥n', color: '#e53e3e' },
            { id: 5, name: 'Cuadernos A4 100 hojas', category: 'Papeler√≠a', quantity: 12, entry: 3, date: '2024-07-14', observations: 'Rayados, buena calidad', color: '#48bb78' },
            { id: 6, name: 'Agua Natural 1L', category: 'Bebidas', quantity: 25, entry: 10, date: '2024-07-13', observations: 'Stock completo', color: '#48bb78' },
            { id: 7, name: 'Producto Descontinuado', category: 'Otros', quantity: 2, entry: 0, date: '2024-07-11', observations: 'Ya no se vende', color: '#2d3748' }
        ];

        // Inicializar la aplicaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            // Permitir login con Enter
            document.getElementById('password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    login();
                }
            });

            // Manejo del formulario de producto
            document.getElementById('productForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveProduct();
            });

            // Manejo del selector de color (solo colores predefinidos)
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('color-option')) {
                    // Remover selecci√≥n anterior
                    document.querySelectorAll('.color-option').forEach(option => {
                        option.classList.remove('selected');
                    });
                    
                    // Seleccionar nuevo color
                    e.target.classList.add('selected');
                    const color = e.target.getAttribute('data-color');
                    document.getElementById('productColor').value = color;
                }
            });

            // Cerrar modal con Escape
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeModal();
                }
            });

            // Cerrar modal al hacer clic fuera
            document.getElementById('productModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal();
                }
            });
        });

        // Funciones de autenticaci√≥n
        function login() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            
            if (!username || !password) {
                alert('üö® Por favor, ingresa usuario y contrase√±a');
                return;
            }
            
            if ((username === 'Admin' && password === 'Maria.Jaime') || 
                (username === 'Yervin' && password === '1303')) {
                currentUser = username;
                document.getElementById('currentUser').textContent = username;
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                
                // Cargar datos de ejemplo
                products = [...sampleProducts];
                nextProductId = Math.max(...products.map(p => p.id)) + 1;
                loadProducts();
                loadCategories();
                logAudit('Inicio de sesi√≥n', '', `Usuario ${username} inici√≥ sesi√≥n exitosamente`);
                
                // Mensaje de bienvenida
                setTimeout(() => {
                    alert(`üéâ ¬°Bienvenido ${username}! Sistema cargado correctamente.`);
                }, 500);
            } else {
                alert('‚ùå Usuario o contrase√±a incorrectos\n\nCredenciales v√°lidas:\n‚Ä¢ Admin / Maria.Jaime\n‚Ä¢ Yervin / 1303');
            }
        }

        function logout() {
            if (confirm('üö™ ¬øEst√°s seguro de que quieres cerrar sesi√≥n?')) {
                logAudit('Cierre de sesi√≥n', '', `Usuario ${currentUser} cerr√≥ sesi√≥n`);
                currentUser = '';
                document.getElementById('loginScreen').style.display = 'block';
                document.getElementById('mainApp').style.display = 'none';
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
                
                // Limpiar formulario de login
                document.getElementById('passwordIcon').className = 'fas fa-eye';
                document.getElementById('password').type = 'password';
            }
        }

        function togglePassword() {
            const passwordField = document.getElementById('password');
            const passwordIcon = document.getElementById('passwordIcon');
            
            if (passwordField.type === 'password') {
                passwordField.type = 'text';
                passwordIcon.className = 'fas fa-eye-slash';
            } else {
                passwordField.type = 'password';
                passwordIcon.className = 'fas fa-eye';
            }
        }

        // Funciones de navegaci√≥n
        function showTab(tabName) {
            const tabs = document.querySelectorAll('.nav-tabs button');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            if (tabName === 'inventory') {
                document.getElementById('inventoryTab').style.display = 'block';
                document.getElementById('auditTab').style.display = 'none';
                tabs[0].classList.add('active');
            } else if (tabName === 'audit') {
                document.getElementById('inventoryTab').style.display = 'none';
                document.getElementById('auditTab').style.display = 'block';
                tabs[1].classList.add('active');
                loadAuditLog();
            }
        }

        // Funciones de productos
        function loadProducts() {
            const tbody = document.getElementById('productsTable');
            tbody.innerHTML = '';
            
            const filteredProducts = filterProductsByCategory();
            
            if (filteredProducts.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="8" style="text-align: center; color: #4a5568; padding: 60px;">
                        <i class="fas fa-box-open" style="font-size: 48px; color: #cbd5e0; margin-bottom: 20px;"></i><br>
                        <strong style="font-size: 18px;">No hay productos para mostrar</strong><br>
                        <span style="font-size: 14px;">Agrega tu primer producto haciendo clic en "Agregar Producto"</span>
                    </td>
                `;
                tbody.appendChild(row);
                return;
            }
            
            filteredProducts.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div class="quantity-status">
                            <div class="quantity-indicator" style="background: ${product.color || '#48bb78'}; box-shadow: 0 2px 4px rgba(0,0,0,0.1);" title="${getCustomStatusText(product)}"></div>
                        </div>
                    </td>
                    <td><strong>${escapeHtml(product.name)}</strong></td>
                    <td><span style="padding: 4px 8px; background: rgba(102, 126, 234, 0.1); border-radius: 6px; font-size: 12px; font-weight: 600;">${escapeHtml(product.category)}</span></td>
                    <td><strong style="font-size: 16px; color: ${product.color || '#48bb78'}">${product.quantity}</strong></td>
                    <td>${formatDate(product.date)}</td>
                    <td>${product.entry > 0 ? `<span style="color: #48bb78; font-weight: 600;">+${product.entry}</span>` : '-'}</td>
                    <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${escapeHtml(product.observations || '')}">${escapeHtml(product.observations || 'Sin observaciones')}</td>
                    <td>
                        <div class="actions">
                            <button class="action-btn edit" onclick="editProduct(${product.id})" title="Editar producto">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete" onclick="deleteProduct(${product.id})" title="Eliminar producto">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function getStatusClass(quantity) {
            if (quantity > 10) return 'status-green';
            if (quantity >= 6) return 'status-yellow';
            if (quantity >= 1) return 'status-orange';
            if (quantity === 0) return 'status-red';
            return 'status-black';
        }

        function getStatusText(quantity) {
            if (quantity > 10) return 'Stock Completo';
            if (quantity >= 6) return 'Stock Medio';
            if (quantity >= 1) return 'Stock Bajo';
            if (quantity === 0) return 'Sin Stock';
            return 'Error en datos';
        }

        function getCustomStatusText(product) {
            return `${product.name} - ${product.quantity} unidades`;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('es-ES', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        }

        function loadCategories() {
            const categoryFilter = document.getElementById('categoryFilter');
            const categories = [...new Set(products.map(p => p.category))].sort();
            
            categoryFilter.innerHTML = '<option value="">üìã Todas las categor√≠as</option>';
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = getCategoryIcon(category) + ' ' + category;
                categoryFilter.appendChild(option);
            });
        }

        function getCategoryIcon(category) {
            const icons = {
                'Bebidas': 'ü•§',
                'Comida': 'üçï',
                'Limpieza': 'üßΩ',
                'Cuidado Personal': 'üß¥',
                'Papeler√≠a': 'üìù',
                'Otros': 'üì¶'
            };
            return icons[category] || 'üì¶';
        }

        function filterProducts() {
            loadProducts();
        }

        function filterProductsByCategory() {
            const selectedCategory = document.getElementById('categoryFilter').value;
            if (!selectedCategory) return products;
            return products.filter(p => p.category === selectedCategory);
        }

        // Funciones del modal
        function showProductModal() {
            editingProductId = null;
            document.getElementById('modalTitle').innerHTML = '<i class="fas fa-plus-circle"></i> Agregar Producto';
            document.getElementById('productForm').reset();
            
            // Seleccionar color verde por defecto
            document.querySelectorAll('.color-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelector('.color-option[data-color="#48bb78"]').classList.add('selected');
            document.getElementById('productColor').value = '#48bb78';
            
            document.getElementById('productModal').style.display = 'block';
            document.getElementById('productName').focus();
        }

        function editProduct(id) {
            const product = products.find(p => p.id === id);
            if (!product) {
                alert('‚ùå Producto no encontrado');
                return;
            }
            
            editingProductId = id;
            document.getElementById('modalTitle').innerHTML = '<i class="fas fa-edit"></i> Editar Producto';
            document.getElementById('productName').value = product.name;
            document.getElementById('productCategory').value = product.category;
            document.getElementById('productQuantity').value = product.quantity;
            document.getElementById('productEntry').value = product.entry;
            document.getElementById('productObservations').value = product.observations || '';
            
            // Configurar el color del producto
            const productColor = product.color || '#48bb78';
            document.getElementById('productColor').value = productColor;
            
            // Seleccionar el color correspondiente
            document.querySelectorAll('.color-option').forEach(option => {
                option.classList.remove('selected');
                if (option.getAttribute('data-color') === productColor) {
                    option.classList.add('selected');
                }
            });
            
            document.getElementById('productModal').style.display = 'block';
            document.getElementById('productName').focus();
        }

        function deleteProduct(id) {
            const product = products.find(p => p.id === id);
            if (!product) {
                alert('‚ùå Producto no encontrado');
                return;
            }
            
            if (confirm(`üóëÔ∏è ¬øEst√°s seguro de que quieres eliminar este producto?\n\nüì¶ ${product.name}\nüìÇ ${product.category}\nüìä Cantidad: ${product.quantity}\n\n‚ö†Ô∏è Esta acci√≥n no se puede deshacer.`)) {
                products = products.filter(p => p.id !== id);
                loadProducts();
                loadCategories();
                logAudit('Eliminar producto', product.name, `Producto eliminado: ${product.name} (${product.category}) - Cantidad: ${product.quantity}`);
                
                // Mostrar confirmaci√≥n
                setTimeout(() => {
                    alert(`‚úÖ Producto "${product.name}" eliminado correctamente`);
                }, 200);
            }
        }

        function closeModal() {
            document.getElementById('productModal').style.display = 'none';
            document.getElementById('productForm').reset();
            editingProductId = null;
        }

        function saveProduct() {
            const name = document.getElementById('productName').value.trim();
            const category = document.getElementById('productCategory').value;
            const quantity = parseInt(document.getElementById('productQuantity').value);
            const entry = parseInt(document.getElementById('productEntry').value) || 0;
            const observations = document.getElementById('productObservations').value.trim();
            const color = document.getElementById('productColor').value;
            
            // Validaciones
            if (!name) {
                alert('‚ùå El nombre del producto es obligatorio');
                document.getElementById('productName').focus();
                return;
            }
            
            if (!category) {
                alert('‚ùå Debes seleccionar una categor√≠a');
                document.getElementById('productCategory').focus();
                return;
            }
            
            if (isNaN(quantity) || quantity < 0) {
                alert('‚ùå La cantidad debe ser un n√∫mero v√°lido mayor o igual a 0');
                document.getElementById('productQuantity').focus();
                return;
            }
            
            if (isNaN(entry) || entry < 0) {
                alert('‚ùå La entrada debe ser un n√∫mero v√°lido mayor o igual a 0');
                document.getElementById('productEntry').focus();
                return;
            }
            
            const currentDate = new Date().toISOString().split('T')[0];
            const finalQuantity = quantity + entry;
            
            if (editingProductId) {
                // Editar producto existente
                const productIndex = products.findIndex(p => p.id === editingProductId);
                if (productIndex !== -1) {
                    const oldProduct = {...products[productIndex]};
                    products[productIndex] = {
                        ...products[productIndex],
                        name,
                        category,
                        quantity: finalQuantity,
                        entry,
                        observations,
                        color,
                        date: currentDate
                    };
                    logAudit('Editar producto', name, `Producto actualizado: ${name} - Cantidad anterior: ${oldProduct.quantity}, Nueva cantidad: ${finalQuantity}, Color: ${color}`);
                    
                    setTimeout(() => {
                        alert(`‚úÖ Producto "${name}" actualizado correctamente\nüìä Nueva cantidad: ${finalQuantity} unidades\nüé® Color: ${color}`);
                    }, 200);
                }
            } else {
                // Agregar nuevo producto
                const newProduct = {
                    id: nextProductId++,
                    name,
                    category,
                    quantity: finalQuantity,
                    entry,
                    observations,
                    color,
                    date: currentDate
                };
                products.push(newProduct);
                logAudit('Agregar producto', name, `Nuevo producto agregado: ${name} (${category}) - Cantidad: ${finalQuantity}, Color: ${color}`);
                
                setTimeout(() => {
                    alert(`‚úÖ Producto "${name}" agregado correctamente\nüìä Cantidad: ${finalQuantity} unidades\nüé® Color personalizado aplicado`);
                }, 200);
            }
            
            loadProducts();
            loadCategories();
            closeModal();
        }

        // Funciones de auditor√≠a
        function logAudit(action, product, details) {
            const auditEntry = {
                id: auditLog.length + 1,
                timestamp: new Date().toLocaleString('es-ES', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                }),
                user: currentUser,
                action,
                product,
                details
            };
            auditLog.push(auditEntry);
        }

        function loadAuditLog() {
            const tbody = document.getElementById('auditTable');
            tbody.innerHTML = '';
            
            if (auditLog.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="5" style="text-align: center; color: #4a5568; padding: 60px;">
                        <i class="fas fa-history" style="font-size: 48px; color: #cbd5e0; margin-bottom: 20px;"></i><br>
                        <strong style="font-size: 18px;">No hay registros de auditor√≠a</strong><br>
                        <span style="font-size: 14px;">Las actividades del sistema aparecer√°n aqu√≠</span>
                    </td>
                `;
                tbody.appendChild(row);
                return;
            }
            
            // Mostrar los √∫ltimos 100 registros en orden inverso
            const recentAudits = auditLog.slice(-100).reverse();
            
            recentAudits.forEach((audit, index) => {
                const row = document.createElement('tr');
                const isRecent = index < 3; // Resaltar los 3 m√°s recientes
                
                row.innerHTML = `
                    <td${isRecent ? ' style="background: rgba(102, 126, 234, 0.05);"' : ''}>${escapeHtml(audit.timestamp)}</td>
                    <td${isRecent ? ' style="background: rgba(102, 126, 234, 0.05);"' : ''}><strong>${escapeHtml(audit.user)}</strong></td>
                    <td${isRecent ? ' style="background: rgba(102, 126, 234, 0.05);"' : ''}><span style="padding: 2px 6px; background: ${getActionColor(audit.action)}; border-radius: 4px; font-size: 11px; font-weight: 600; color: white;">${escapeHtml(audit.action)}</span></td>
                    <td${isRecent ? ' style="background: rgba(102, 126, 234, 0.05);"' : ''}><strong>${escapeHtml(audit.product)}</strong></td>
                    <td${isRecent ? ' style="background: rgba(102, 126, 234, 0.05);"' : ''} style="max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${escapeHtml(audit.details)}">${escapeHtml(audit.details)}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function getActionColor(action) {
            const colors = {
                'Agregar producto': '#48bb78',
                'Editar producto': '#ed8936',
                'Eliminar producto': '#e53e3e',
                'Inicio de sesi√≥n': '#667eea',
                'Cierre de sesi√≥n': '#4a5568'
            };
            return colors[action] || '#4a5568';
        }

        // Funci√≥n auxiliar para escapar HTML
        function escapeHtml(text) {
            if (typeof text !== 'string') return text;
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, function(m) { return map[m]; });
        }

        // Funciones de utilidad adicionales
        function getCurrentStats() {
            const totalProducts = products.length;
            const totalQuantity = products.reduce((sum, p) => sum + p.quantity, 0);
            const lowStock = products.filter(p => p.quantity <= 5).length;
            const outOfStock = products.filter(p => p.quantity === 0).length;
            
            return {
                totalProducts,
                totalQuantity,
                lowStock,
                outOfStock
            };
        }

        // Auto-guardar en localStorage para persistencia
        function saveToLocalStorage() {
            try {
                localStorage.setItem('donYeyoInventory', JSON.stringify({
                    products: products,
                    auditLog: auditLog,
                    nextProductId: nextProductId
                }));
            } catch (error) {
                console.warn('No se pudo guardar en localStorage:', error);
            }
        }

        function loadFromLocalStorage() {
            try {
                const saved = localStorage.getItem('donYeyoInventory');
                if (saved) {
                    const data = JSON.parse(saved);
                    products = data.products || [...sampleProducts];
                    auditLog = data.auditLog || [];
                    nextProductId = data.nextProductId || (Math.max(...products.map(p => p.id)) + 1);
                    return true;
                }
            } catch (error) {
                console.warn('No se pudo cargar desde localStorage:', error);
            }
            return false;
        }

        // Interceptar cambios para auto-guardar
        const originalLogAudit = logAudit;
        logAudit = function(...args) {
            originalLogAudit.apply(this, args);
            saveToLocalStorage();
        };

        // Cargar datos al inicializar si existen
        document.addEventListener('DOMContentLoaded', function() {
            if (!loadFromLocalStorage()) {
                // Si no hay datos guardados, usar los de ejemplo
                products = [...sampleProducts];
                nextProductId = Math.max(...products.map(p => p.id)) + 1;
            }
        });
    </script>
</body>
</html>
